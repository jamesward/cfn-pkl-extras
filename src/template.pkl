module `cfn-pkl-extras`.template

import "@cfn/template.pkl" as cloudformationTemplate
import "route53.pkl"
import "patterns.pkl"

/// The domain name contact to be applied to all records
contact: route53.Contact

/// Domains to be registered with / transfered to Route53
registeredDomains: Mapping<route53.ApexDomainName, patterns.DomainDetails>

/// Domains registered on external registrars
externalDomains: Mapping<route53.ApexDomainName, patterns.ExternalDomainDetails>

// todo: some way to set a contact per domain
fixed cloudFormation: cloudformationTemplate =
  let (_contact = contact)
  let (domains = new patterns.Domains {
    contact = _contact
    domains = registeredDomains
  })
  let (externalDomains = new patterns.ExternalDomains {
    domains = externalDomains
  })

  new {
    Resources {
      ...route53.hostedZoneCustomResource.resources
      ...domains.resources
      ...externalDomains.resources
    }

    Outputs {
      ...domains.outputs
      ...externalDomains.outputs
    }
  }

output = cloudFormation.output
